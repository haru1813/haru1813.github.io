<script setup>
import ArticleHeader from '@/components/ArticleHeader.vue'
import ArticleBody from '@/components/ArticleBody.vue'

const post = {
  id: "springboot-test",
  title: "Spring Boot 테스트 전략과 예제",
  date: "2026-02-11",
  summary: "JUnit 5, MockMvc, @DataJpaTest, @WebFluxTest, @MockBean, 통합 테스트, 컨테이너 테스트까지 Spring Boot 테스트의 모든 것을 정리합니다.",
  category: "Technology/SpringBoot",
  tags: ["springboot","test","junit","mockmvc","backend"],
  content: ["## Spring Boot 테스트 개요", "Spring Boot는 `spring-boot-starter-test`로 JUnit 5, Mockito, AssertJ, MockMvc를 함께 제공합니다. 단위 테스트부터 통합 테스트, 슬라이스 테스트까지 단계별로 정리합니다.", "", "## 1) 의존성", "```xml", "<dependency>", "    <groupId>org.springframework.boot</groupId>", "    <artifactId>spring-boot-starter-test</artifactId>", "    <scope>test</scope>", "</dependency>", "```", "", "## 2) @SpringBootTest (통합 테스트)", "전체 컨텍스트를 로드하고 실제 Bean을 사용합니다.", "", "```java", "@SpringBootTest(webEnvironment = WebEnvironment.RANDOM_PORT)", "class UserIntegrationTest {", "    @Autowired", "    private TestRestTemplate restTemplate;", "", "    @Test", "    void createUser() {", "        var req = new CreateUserRequest(\"홍길동\", \"hong@test.com\", 25);", "        var res = restTemplate.postForEntity(\"/api/users\", req, UserResponse.class);", "        assertThat(res.getStatusCode()).isEqualTo(HttpStatus.CREATED);", "        assertThat(res.getBody().name()).isEqualTo(\"홍길동\");", "    }", "}", "```", "", "## 3) @WebMvcTest (Controller 슬라이스)", "Controller 레이어만 로드하고 나머지는 Mock으로 주입합니다.", "", "```java", "@WebMvcTest(UserController.class)", "class UserControllerTest {", "    @Autowired", "    private MockMvc mockMvc;", "    @MockBean", "    private UserService userService;", "", "    @Test", "    void getUser() throws Exception {", "        when(userService.findById(1L))", "            .thenReturn(new UserResponse(1L, \"홍길동\", \"hong@test.com\", 25));", "", "        mockMvc.perform(get(\"/api/users/1\"))", "            .andExpect(status().isOk())", "            .andExpect(jsonPath(\"$.name\").value(\"홍길동\"));", "    }", "}", "```", "", "## 4) @DataJpaTest (Repository 슬라이스)", "JPA 레이어만 로드하고 기본적으로 인메모리 DB(H2)를 사용합니다.", "", "```java", "@DataJpaTest", "class UserRepositoryTest {", "    @Autowired", "    private UserRepository userRepo;", "", "    @Test", "    void saveAndFind() {", "        var user = new User(\"홍길동\", \"hong@test.com\");", "        userRepo.save(user);", "        assertThat(userRepo.findById(user.getId())).isPresent();", "    }", "}", "```", "", "## 5) @WebFluxTest (WebFlux Controller)", "```java", "@WebFluxTest(ProductController.class)", "class ProductControllerTest {", "    @Autowired", "    private WebTestClient webTestClient;", "    @MockBean", "    private ProductRepository productRepo;", "", "    @Test", "    void listProducts() {", "        when(productRepo.findAll()).thenReturn(Flux.just(", "            new Product(\"1\", \"item1\"), new Product(\"2\", \"item2\")));", "", "        webTestClient.get().uri(\"/api/products\")", "            .exchange()", "            .expectStatus().isOk()", "            .expectBodyList(Product.class).hasSize(2);", "    }", "}", "```", "", "## 6) @MockBean", "테스트 컨텍스트에 Mock Bean을 등록합니다. 실제 Bean을 대체할 때 사용합니다.", "", "```java", "@SpringBootTest", "class OrderServiceTest {", "    @Autowired", "    private OrderService orderService;", "    @MockBean", "    private PaymentClient paymentClient;", "", "    @Test", "    void orderWithPayment() {", "        when(paymentClient.charge(any())).thenReturn(PaymentResult.success());", "        var order = orderService.create(new OrderRequest(...));", "        assertThat(order.getStatus()).isEqualTo(OrderStatus.PAID);", "    }", "}", "```", "", "## 7) Testcontainers (실제 DB)", "```xml", "<dependency>", "    <groupId>org.springframework.boot</groupId>", "    <artifactId>spring-boot-testcontainers</artifactId>", "    <scope>test</scope>", "</dependency>", "```", "", "```java", "@SpringBootTest", "@Testcontainers", "class UserRepositoryIntegrationTest {", "    @Container", "    static PostgreSQLContainer<?> postgres = new PostgreSQLContainer<>(\"postgres:16\");", "", "    @DynamicPropertySource", "    static void props(DynamicPropertyRegistry registry) {", "        registry.add(\"spring.datasource.url\", postgres::getJdbcUrl);", "        registry.add(\"spring.datasource.username\", postgres::getUsername);", "        registry.add(\"spring.datasource.password\", postgres::getPassword);", "    }", "", "    @Autowired", "    private UserRepository repo;", "", "    @Test", "    void saveWithRealDb() {", "        repo.save(new User(\"test\", \"t@t.com\"));", "        assertThat(repo.count()).isEqualTo(1);", "    }", "}", "```", "", "## 정리", "Spring Boot 테스트는 @SpringBootTest(통합), @WebMvcTest/@DataJpaTest(슬라이스), @MockBean(의존성 격리)로 유연하게 구성할 수 있습니다. Testcontainers로 실제 DB 연동 테스트까지 가능합니다."]
}
</script>

<template>
  <ArticleHeader :post="post" />
  <ArticleBody :content="post.content" />
</template>
